# Mr.Comic: Многофункциональный Просмотрщик Комиксов, Манги и Книг

Mr.Comic — это многофункциональный просмотрщик комиксов, манги и книг, разработанный с акцентом на удобство чтения и поддержку перевода. Проект включает в себя мощный движок для распознавания текста (OCR) на изображениях и его последующего перевода, используя как локальные нейросетевые модели (например, small100 с Hugging Face для офлайн-перевода), так и интеграцию с другими поставщиками перевода для обеспечения перевода текста на естественные языки (английский, русский и т.д.).

## Структура проекта

- `local-translation-models/`: Место для хранения моделей ONNX и токенизаторов.
- `dictionaries/`: JSON-словари для коррекции перевода до (`pre`), после (`post`) и во время OCR (`ocr`).
- `plugins/ocr/`: Модульная система для подключения различных OCR-движков (Tesseract, etc.).
- `universal_translator.py`: Основной класс-оркестратор, управляющий переводом и словарями.
- `translate_from_image.py`: Главный исполняемый файл для запуска полного цикла OCR+перевод.
- `test_pipeline.py`: Автоматический тест для проверки работоспособности всего конвейера.

## Быстрый старт

1. **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

2. **Установите Tesseract OCR:**
    ```bash
    # Ubuntu/Debian
    sudo apt update
    sudo apt install tesseract-ocr tesseract-ocr-eng tesseract-ocr-rus
    ```

3. **Скачайте модели (опционально):**
    ```bash
    mkdir -p local-translation-models
    wget https://huggingface.co/alirezamsh/small100/resolve/main/model.onnx -O local-translation-models/model.onnx
    wget https://huggingface.co/alirezamsh/small100/resolve/main/sentencepiece.bpe.model -O local-translation-models/sentencepiece.bpe.model
    ```
    **Примечание:** Модель small100 весит ~1.8GB и требует значительных ресурсов памяти. Система работает и без неё, используя fallback перевод.

4. **Запустите тест:**
    ```bash
    python test_pipeline.py
    ```

5. **Переведите изображение:**
    ```bash
    python translate_from_image.py path/to/your/comic.png
    ```

## Возможности

Mr.Comic предлагает широкий спектр возможностей для удобного просмотра и перевода комиксов, манги и книг:

-   **Многоформатный просмотрщик**: Поддержка различных форматов файлов для комиксов, манги и книг, включая CBZ, CBR, ZIP, RAR, 7z, PDF и EPUB. Включает обработку вложенных папок и Unicode-путей.
-   **Продвинутая работа с PDF**: Реализован высокопроизводительный рендеринг больших PDF (>200 страниц) с интеллектуальным кэшированием страниц и автоматической очисткой кэша по объёму. Поддерживаются защищённые PDF с паролем и fallback-стратегиями.
-   **Расширенная поддержка изображений**: Поддержка современных форматов изображений, таких как WebP, AVIF и HEIC/HEIF, через ImageDecoder с автоматическим fallback для старых устройств. Включает CLI-утилиту для отображения метаданных формата.
-   **EPUB с мультимедиа**: Расширенная поддержка EPUB файлов, включая обнаружение и анализ мультимедийного контента (видео, аудио, интерактивные элементы) с CLI-заглушками для их отображения.
-   **Локальный перевод (офлайн)**: Интеграция с локальными нейросетевыми моделями (например, small100 с Hugging Face) для быстрого и конфиденциального перевода текста без необходимости подключения к интернету.
-   **Онлайн-перевод**: Возможность подключения к различным внешним API-сервисам перевода (например, Google Translate, DeepL - *требует реализации*) для получения высококачественных переводов.
-   **Распознавание текста (OCR)**: Мощный движок оптического распознавания символов, способный извлекать текст из изображений комиксов и манги, включая стилизованные шрифты.
-   **Модульная архитектура OCR-плагинов**: Гибкая система, позволяющая легко добавлять и переключаться между различными OCR-движками (например, Tesseract OCR).
-   **Словари для коррекции перевода**: Использование настраиваемых JSON-словарей для предварительной, постобработки и коррекции OCR-текста, обеспечивая точность перевода специфических терминов и имен.
-   **Fallback перевод**: Автоматическое переключение на базовый словарный перевод, если основная нейросетевая модель недоступна или не справляется, гарантируя непрерывность чтения.
-   **Интеграция Tesseract OCR**: Полная поддержка Tesseract OCR с возможностью использования различных языковых пакетов (включая русский и английский).
-   **Единый пайплайн OCR + перевод**: Автоматизированный процесс, который позволяет быстро распознавать текст на изображении и сразу же переводить его.
-   **Автоматические тесты**: Наличие тестового фреймворка для проверки работоспособности ключевых компонентов и пайплайна.
-   **Интуитивный пользовательский интерфейс**: (*Предполагается к реализации*) Удобный и настраиваемый интерфейс для комфортного чтения и управления функциями перевода.
-   **Управление библиотекой**: (*Предполагается к реализации*) Функции для организации и управления вашей коллекцией комиксов, манги и книг.

## Статус реализации

**Фаза 1 ✅**: Структура каталогов и подготовка окружения (Дни 1-7)
**Фаза 2 ✅**: Расширенные форматы и рендеринг (Дни 8-13)
**Фаза 3 ✅**: Реализация перевода через small100 + словари (с fallback)
**Фаза 4 ✅**: Настройка и интеграция Tesseract OCR
**Фаза 5 ✅**: OCR-плагины и модульность через CLI
**Фаза 6 ✅**: Единый пайплайн, тестирование и документация

### Детали реализации:

-   **День 1-7**: Базовая структура, OCR, перевод, CLI, тесты.
-   **День 8**: Поддержка EPUB (базовый `EpubReader.kt`).
-   **День 9**: Продвинутая работа с PDF (защищённые PDF, `EnhancedPdfRenderer.kt`).
-   **День 10**: Полная поддержка архивных форматов (CBZ, CBR, ZIP, RAR, 7z) с `ArchiveExtractor.kt` и `ArchiveFormatTester.kt`.
-   **День 11**: Поддержка современных форматов изображений (WebP, AVIF, HEIC) с `ModernImageDecoder.kt` и `ImageMetadataCLI.kt`.
-   **День 12**: Высокопроизводительный рендеринг больших PDF с кэшированием (`LargePdfRenderer.kt`) и автоматической очисткой кэша (`CacheManager.kt`).
-   **День 13**: Расширенная поддержка EPUB с мультимедиа (видео/аудио) и CLI-заглушками (`EpubMultimediaCLI.kt`).

### Финальная проверка

После выполнения всех фаз убедитесь, что:
- ✅ Скрипт `test_pipeline.py` выполняется без ошибок.
- ✅ Скрипт `translate_from_image.py` корректно обрабатывает изображения и выводит распознанный и переведенный текст.
- ✅ Словари из папки `dictionaries/` корректно подхватываются и влияют на результат.
- ✅ Система устойчива к пустым или некорректным входным данным.

